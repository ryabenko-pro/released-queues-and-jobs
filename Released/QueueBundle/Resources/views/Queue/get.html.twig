{% extends base_template %}

{% block body %}
    {% for type, messages in app.session.flashbag.all %}
        {% for message in messages %}
            <div class="alert alert-{{ type }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}
    <h1>Tasks {{ task.id }}</h1>

    <hr>

    <p>
        Server time: <strong>{{ "now"|date }}</strong>
    </p>
    <table class="table table-striped table-hover" style="table-layout: fixed; max-width: 1140px;">
        <thead>
            <tr>
                <th width="20%">Type</th>
                <th width="10%">Status</th>
                <th width="7%">Restart</th>
                <th width="5%">Wait</th>
                <th width="7%">Cancel</th>
                <th width="16%">Data</th>
                <th width="35%">Log</th>
            </tr>
        </thead>
        <tbody>
            <tr class="task-{{ task.state }}">
                <td>
                    <strong>{{ task.type }}</strong><br>
                    <small>Created at: {{ task.createdAt|date }}</small>
                    {% if task.scheduledAt %}
                        <div><small>Scheduled at: {{ task.scheduledAt|date }}</small></div>
                    {% endif %}
                </td>
                <td>
                    {{ task.state }}
                    {% if task.state == 'new' and task.scheduledAt %}
                        <div><small>{{ task.scheduledAt|date }}</small></div>
                    {% endif %}
                </td>
                <td>
                    {% if task.cancelled or task.running %}
                        ----
                    {% else %}
                        <a class="btn btn-success" href="{{ path('released_queue_task_retry', {id: task.id}) }}">Restart</a>
                    {% endif %}
                </td>
                <td>
                    {% if task.cancelled or task.running or task.waiting %}
                        ----
                    {% else %}
                        <a class="btn btn-success" href="{{ path('released_queue_task_suspend', {id: task.id}) }}">Wait</a>
                    {% endif %}
                </td>
                <td>
                    {% if task.cancelled or task.running %}
                        ----
                    {% else %}
                        <a class="btn btn-success" href="{{ path('released_queue_task_cancel', {id: task.id}) }}">Cancel</a>
                    {% endif %}
                </td>
                <td>
                    <pre>{{ task.data|yaml_encode(2) }}</pre>
                </td>
                <td>
                    <pre>{{ task.log | raw }}</pre>
                </td>
            </tr>
        </tbody>
    </table>
{% endblock %}